<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ‰æ©ŸåŒ–å­¦ãƒã‚¹ã‚¿ãƒ¼ - Organic Chem Master</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs (Modular) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, updateDoc, onSnapshot, addDoc, query, where, orderBy, serverTimestamp, writeBatch, deleteDoc, increment, Timestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // Expose Firebase to window for React component to use
        window.firebaseModules = { 
            initializeApp, getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInAnonymously, onAuthStateChanged, signOut,
            getFirestore, collection, doc, setDoc, getDoc, getDocs, updateDoc, onSnapshot, addDoc, query, where, orderBy, serverTimestamp, writeBatch, deleteDoc, increment, Timestamp
        };
    </script>

    <!-- Custom Styles for Animations -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap');
        
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #f0fdf4; /* Green-50 */
        }
        
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .slide-up { animation: slideUp 0.5s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .stamp-animation { animation: stamp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes stamp { 
            0% { transform: scale(3); opacity: 0; } 
            100% { transform: scale(1); opacity: 1; } 
        }

        .correct-flash { animation: flashGreen 0.5s; }
        @keyframes flashGreen { 0%, 100% { background-color: white; } 50% { background-color: #bbf7d0; } }

        .wrong-flash { animation: flashRed 0.5s; }
        @keyframes flashRed { 0%, 100% { background-color: white; } 50% { background-color: #fecaca; } }

        /* Modal Animation */
        .modal-enter { opacity: 0; transform: scale(0.9); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 300ms, transform 300ms; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.9); transition: opacity 300ms, transform 300ms; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // --- Configuration & Data ---
        
        const firebaseConfig = {
            apiKey: "AIzaSyCPziY4qZiRI0LbWXrSCnsOhJUxNwvdxxE",
            authDomain: "organic-chem-master-74df8.firebaseapp.com",
            projectId: "organic-chem-master-74df8",
            storageBucket: "organic-chem-master-74df8.firebasestorage.app",
            messagingSenderId: "729011758610",
            appId: "1:729011758610:web:50fbddf730d36a90969acb"
        };

        const COMPOUNDS_RAW = [
            { id: 1, name: "ãƒ¡ã‚¿ãƒ³", url: "https://drive.google.com/uc?id=1qwuf3wdb9DWG1n6wwx_D3qTRjn3Ozt1S" },
            { id: 2, name: "ã‚¨ã‚¿ãƒ³", url: "https://drive.google.com/uc?id=1CrOzeJ4pHTSDreMKtZeWKLdP6POBxS7d" },
            { id: 3, name: "ãƒ—ãƒ­ãƒ‘ãƒ³", url: "https://drive.google.com/uc?id=1g3wFagtQJdkVIqgtU4Zzmhpy-F-0xGEH" },
            { id: 4, name: "ãƒ–ã‚¿ãƒ³", url: "https://drive.google.com/uc?id=1GwZ2WI5EgpAev0fW497sDMdMIZQeWqhK" },
            { id: 5, name: "ãƒšãƒ³ã‚¿ãƒ³", url: "https://drive.google.com/uc?id=1G7-wExihdcCFunGU7hLcc_jHkG9xODYH" },
            { id: 6, name: "ãƒ˜ã‚­ã‚µãƒ³", url: "https://drive.google.com/uc?id=1gYPQLybCXaHBVabLOIXvSuS2uMpBNE25" },
            { id: 7, name: "ãƒ˜ãƒ—ã‚¿ãƒ³", url: "https://drive.google.com/uc?id=1vP4aOetzSTxuY8mOuMcXE_SCCl0a6s9S" },
            { id: 8, name: "ã‚ªã‚¯ã‚¿ãƒ³", url: "https://drive.google.com/uc?id=1ceqcVpHUDIl9l5pYE0qs5T5fNx4rG5vz" },
            { id: 9, name: "ãƒãƒŠãƒ³", url: "https://drive.google.com/uc?id=1yRa3bZWP4aQWTnYXva2ajI_GXKDnTYxj" },
            { id: 10, name: "ãƒ‡ã‚«ãƒ³", url: "https://drive.google.com/uc?id=1F7_wGXPKV4oSHUShlhAT5sijTxxowW3m" },
            { id: 11, name: "2-ãƒ¡ãƒãƒ«ãƒ—ãƒ­ãƒ‘ãƒ³", url: "https://drive.google.com/uc?id=18oEhAyKLlBY9dQ3M5_AjTw8VKa5a_cjZ" },
            { id: 12, name: "2,2-ã‚¸ãƒ¡ãƒãƒ«ãƒ—ãƒ­ãƒ‘ãƒ³", url: "https://drive.google.com/uc?id=1kOHmza4LS48n3v75odFXdvf-rv5mfb0z" },
            { id: 13, name: "2-ãƒ¡ãƒãƒ«ãƒ–ã‚¿ãƒ³", url: "https://drive.google.com/uc?id=1S9bQgZdSX_lh4_CMkXMZU0_DdRGXImdi" },
            { id: 14, name: "ã‚¯ãƒ­ãƒ­ãƒ¡ã‚¿ãƒ³", url: "https://drive.google.com/uc?id=1nb7fZllNwzaMehukxofoQvrZgJoZsrIg" },
            { id: 15, name: "ã‚·ã‚¯ãƒ­ãƒ—ãƒ­ãƒ‘ãƒ³", url: "https://drive.google.com/uc?id=1X-JfZD8UX8X1A7Z8JYfog8ySPLHaIrfb" },
            { id: 16, name: "ã‚·ã‚¯ãƒ­ãƒ–ã‚¿ãƒ³", url: "https://drive.google.com/uc?id=1G2di0KGHHwb7XrrujmtCx2LnKtqR3GKh" },
            { id: 17, name: "ã‚·ã‚¯ãƒ­ãƒšãƒ³ã‚¿ãƒ³", url: "https://drive.google.com/uc?id=1mujXix4X9rXHMuHvmSDhHbyIlNTugv6a" },
            { id: 18, name: "ã‚·ã‚¯ãƒ­ãƒ˜ã‚­ã‚µãƒ³", url: "https://drive.google.com/uc?id=1p9nsVX1Imr73OgdWf6-3WCxC66UidiQi" },
            { id: 19, name: "1,3-ã‚¸ãƒ–ãƒ­ãƒ¢ãƒ—ãƒ­ãƒ‘ãƒ³", url: "https://drive.google.com/uc?id=1V14tJWEQqLjSmGm8QlSp_ln_HfgwwJju" },
            { id: 20, name: "ã‚¨ãƒãƒ¬ãƒ³", url: "https://drive.google.com/uc?id=1wRQCUZqXTDcxvfr-mxGY_SBmD2bh-2gj" },
            { id: 21, name: "ãƒ—ãƒ­ãƒšãƒ³", url: "https://drive.google.com/uc?id=1NEWWg-VwBzsPUJ2mdCwBVXTal7r-rnbz" },
            { id: 22, name: "1-ãƒ–ãƒ†ãƒ³", url: "https://drive.google.com/uc?id=1S-v3oD6zbcRE-TpF1jEyISQLi9aIrrFR" },
            { id: 23, name: "1-ãƒšãƒ³ãƒ†ãƒ³", url: "https://drive.google.com/uc?id=1IgA0UmN8wvQckAyrkIMCwkZrHodzL80E" },
            { id: 24, name: "ãƒãƒªã‚¨ãƒãƒ¬ãƒ³", url: "https://drive.google.com/uc?id=1YcDY-GFAoX7qufa0slHtWbWjcR6mqYzi" },
            { id: 25, name: "1,2-ã‚¸ã‚¯ãƒ­ãƒ­ã‚¨ã‚¿ãƒ³", url: "https://drive.google.com/uc?id=1nks_uca294VAITXzfBGxXjOK1INht9Un" },
            { id: 26, name: "å¡©åŒ–ãƒ“ãƒ‹ãƒ«", url: "https://drive.google.com/uc?id=14YA0CDzodiyBybgaXGxlKmdQ1A-AuFCB" },
            { id: 27, name: "ãƒãƒªå¡©åŒ–ãƒ“ãƒ‹ãƒ«", url: "https://drive.google.com/uc?id=1UtJ86puivNGIpex6OvgwpMqMVWp-igkS" },
            { id: 28, name: "ã‚·ã‚¯ãƒ­ãƒ˜ã‚­ã‚»ãƒ³", url: "https://drive.google.com/uc?id=1dwbFMkOn1_oxQrOqs9eRa0t0cirVJu_k" },
            { id: 29, name: "1,2-ã‚¸ãƒ–ãƒ­ãƒ¢ã‚·ã‚¯ãƒ­ãƒ˜ã‚­ã‚µãƒ³", url: "https://drive.google.com/uc?id=1dYgIwT2xjSN9lkFrRo6_vhBztKZX5EgB" },
            { id: 30, name: "ã‚¢ã‚»ãƒãƒ¬ãƒ³", url: "https://drive.google.com/uc?id=16Vxtx6QRUNafLi6gJUWiiYacNdgqJVY4" },
            { id: 31, name: "ãƒ—ãƒ­ãƒ”ãƒ³", url: "https://drive.google.com/uc?id=1fOD_Q9hUaL3s3jFiz6zjnjXpxnprW_KC" },
            { id: 32, name: "1-ãƒ–ãƒãƒ³", url: "https://drive.google.com/uc?id=1Ks4mgkY_atH0HfpAX5mfU1LF8_iIAlZJ" },
            { id: 33, name: "2-ãƒ–ãƒãƒ³", url: "https://drive.google.com/uc?id=1hDy-mm3_QV8aSBMrqW9468DMsaFsTVMf" },
            { id: 34, name: "1,2-ã‚¸ãƒ–ãƒ­ãƒ¢ã‚¨ãƒãƒ¬ãƒ³", url: "https://drive.google.com/uc?id=1GpIi5c0qqENnbS5I-L9xL20eG8mCmas6" },
            { id: 35, name: "1,1,2,2-ãƒ†ãƒˆãƒ©ãƒ–ãƒ­ãƒ¢ã‚¨ã‚¿ãƒ³", url: "https://drive.google.com/uc?id=18p2hLqqmn7HD_fvoqsfSQUQibXsPSYsk" },
            { id: 36, name: "é…¢é…¸ãƒ“ãƒ‹ãƒ«", url: "https://drive.google.com/uc?id=1MCqTU1bxjop9Cx1N7DiZLYUQNUazgWgr" },
            { id: 37, name: "ãƒ“ãƒ‹ãƒ«ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=17I2aAY0DaogMmdyz8RBB-xhGOEtNJ_2o" },
            { id: 38, name: "ãƒ¡ã‚¿ãƒãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1MLRk9V36HeUz4ykQSluAOr7XKSt51OUw" },
            { id: 39, name: "ã‚¨ã‚¿ãƒãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=17VYiJStifeQi-z5l3f-vCJPF2KqDXO7T" },
            { id: 40, name: "1-ãƒ—ãƒ­ãƒ‘ãƒãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1FHisQ7G4_5NDVKOLjd5XEC33bbePpR5c" },
            { id: 41, name: "2-ãƒ—ãƒ­ãƒ‘ãƒãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1af_8yBLA5W5jRzSiOhFNJ9kxWv46P0oY" },
            { id: 42, name: "1-ãƒ–ã‚¿ãƒãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1uOTbTvfnp_ku5v2aZg9sEqex-VnubXXP" },
            { id: 43, name: "2-ãƒ–ã‚¿ãƒãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1qpRtUvwn2jFER_b6FzTbNO379Lr5pBTJ" },
            { id: 44, name: "2-ãƒ¡ãƒãƒ«-2-ãƒ—ãƒ­ãƒ‘ãƒãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1xc3eo0TcClPmZixn9CYsuwYTZ4PUGLGh" },
            { id: 45, name: "ã‚¨ãƒãƒ¬ãƒ³ã‚°ãƒªã‚³ãƒ¼ãƒ«(1,2-ã‚¨ã‚¿ãƒ³ã‚¸ã‚ªãƒ¼ãƒ«)", url: "https://drive.google.com/uc?id=1jrCSgMRlDQykc41WeeRkr4zu2iMxzPwz" },
            { id: 46, name: "ã‚°ãƒªã‚»ãƒªãƒ³(1,2,3-ãƒ—ãƒ­ãƒ‘ãƒ³ãƒˆãƒªã‚ªãƒ¼ãƒ«)", url: "https://drive.google.com/uc?id=1-ncB_GUXGdBWBRZniHzLule8Xk8SLzgn" },
            { id: 47, name: "ã‚¸ãƒ¡ãƒãƒ«ã‚¨ãƒ¼ãƒ†ãƒ«", url: "https://drive.google.com/uc?id=1a9FO6e0OUXb6K3B5ZYWAuBdgnc9RadeU" },
            { id: 48, name: "ã‚¸ã‚¨ãƒãƒ«ã‚¨ãƒ¼ãƒ†ãƒ«", url: "https://drive.google.com/uc?id=1oAflkadU9EOIhG8zoYQ4JgZ7mH8s2N6e" },
            { id: 49, name: "ãƒ›ãƒ«ãƒ ã‚¢ãƒ«ãƒ‡ãƒ’ãƒ‰", url: "https://drive.google.com/uc?id=1vlTBTgEduTZngEsoJjkwnjRHPJzyfJPs" },
            { id: 50, name: "ã‚¢ã‚»ãƒˆã‚¢ãƒ«ãƒ‡ãƒ’ãƒ‰", url: "https://drive.google.com/uc?id=1Ff-uoS4SnqS6I-Vz0bcKAguRVP6jaAB7" },
            { id: 51, name: "ã‚¢ã‚»ãƒˆãƒ³", url: "https://drive.google.com/uc?id=13dSmxVaIhnBIRuLJQvi_-BcY32fCqID5" },
            { id: 52, name: "ã‚¸ã‚¨ãƒãƒ«ã‚±ãƒˆãƒ³", url: "https://drive.google.com/uc?id=1mtAlD4eKCGXVmgEF86tlrSIS9MqCbH0S" },
            { id: 53, name: "ã‚¨ãƒãƒ«ãƒ¡ãƒãƒ«ã‚±ãƒˆãƒ³", url: "https://drive.google.com/uc?id=1j8fQ9j_EGZ5FEv9IMgSIDrLaRbIAbaEh" },
            { id: 54, name: "ã‚®é…¸", url: "https://drive.google.com/uc?id=1pSYdqFdPEolimAhXq40f9DOg9IIhyS2M" },
            { id: 55, name: "é…¢é…¸", url: "https://drive.google.com/uc?id=1ol0tKW88zkow04y6j4Q9rxoO23xRCcik" },
            { id: 56, name: "ãƒ—ãƒ­ãƒ”ã‚ªãƒ³é…¸", url: "https://drive.google.com/uc?id=18wtdKAoZ2APZTUIZ73OR-6v1BA5jhZf8" },
            { id: 57, name: "ã‚·ãƒ¥ã‚¦é…¸", url: "https://drive.google.com/uc?id=1uo6YMqjLTTuNiv157UeYJnCJqetoui0U" },
            { id: 58, name: "ãƒ•ãƒãƒ«é…¸", url: "https://drive.google.com/uc?id=1n-PtMeWqPcqWm-VIZeKPX73Fr_7-kKsP" },
            { id: 59, name: "ãƒãƒ¬ã‚¤ãƒ³é…¸", url: "https://drive.google.com/uc?id=1em_wSlTI1Yqlb0v2_6CsHbsoubcoPsfK" },
            { id: 60, name: "ã‚®é…¸ãƒ¡ãƒãƒ«", url: "https://drive.google.com/uc?id=1VDsxFdP2H0gENGLVaQKNI82J_TPW999t" },
            { id: 61, name: "ã‚®é…¸ã‚¨ãƒãƒ«", url: "https://drive.google.com/uc?id=13XA16_FcKMwkAsIKZLNK66t0Gtncan5b" },
            { id: 62, name: "é…¢é…¸ãƒ¡ãƒãƒ«", url: "https://drive.google.com/uc?id=1lLEnHVhuPbhBTy_LSsNmwq-M63GK4vX6" },
            { id: 63, name: "é…¢é…¸ã‚¨ãƒãƒ«", url: "https://drive.google.com/uc?id=1wtj8VfQClmn3oSLXSFbxJ80mVohAcpDY" },
            { id: 64, name: "ãƒ‹ãƒˆãƒ­ã‚°ãƒªã‚»ãƒªãƒ³", url: "https://drive.google.com/uc?id=1ucWCMs6PLxxHv1gHf0jay4jQ19JV1JJp" },
            { id: 65, name: "ç„¡æ°´é…¢é…¸", url: "https://drive.google.com/uc?id=1vwwmjs8pot9IgWliT9Z_9E3Iq0qT-Q6c" },
            { id: 66, name: "ç„¡æ°´ãƒãƒ¬ã‚¤ãƒ³é…¸", url: "https://drive.google.com/uc?id=1Y77s0YNIcO0A9VlgiE12Mz09WmkYIeph" },
            { id: 67, name: "ã‚¹ãƒ†ã‚¢ãƒªãƒ³é…¸", url: "https://drive.google.com/uc?id=1VpuN8v9dWYNp6SBFjXQJV2lz3P74HuPp" },
            { id: 68, name: "ã‚ªãƒ¬ã‚¤ãƒ³é…¸", url: "https://drive.google.com/uc?id=1AorSLuRzZVukm3tu9xN3ifFg3jlrNkxL" },
            { id: 69, name: "ãƒªãƒãƒ¼ãƒ«é…¸", url: "https://drive.google.com/uc?id=1ZQ-tGPuv-YxAcmBzmVe4YBuF_DQUCejW" },
            { id: 70, name: "ãƒªãƒãƒ¬ãƒ³é…¸", url: "https://drive.google.com/uc?id=1fDP2ZMIt-Nfy9-c6YkScUnahe87FzB6C" },
            { id: 71, name: "ãƒ‘ãƒ«ãƒŸãƒãƒ³é…¸", url: "https://drive.google.com/uc?id=1-PC9yIEf9xKySuteoMBHyMlwYKIjlmb-" },
            { id: 72, name: "ãƒˆãƒ«ã‚¨ãƒ³", url: "https://drive.google.com/uc?id=1chwCVv0x0nx3Ljs2Us9C6do2z4s6qc_-" },
            { id: 73, name: "o-ã‚­ã‚·ãƒ¬ãƒ³", url: "https://drive.google.com/uc?id=1vvSIPoASaLA1YnhHKKhqm4NpyewSEWyI" },
            { id: 74, name: "m-ã‚­ã‚·ãƒ¬ãƒ³", url: "https://drive.google.com/uc?id=1xBbpXrglhh1jFwxhcf5jcLn2GKKf1bw9" },
            { id: 75, name: "p-ã‚­ã‚·ãƒ¬ãƒ³", url: "https://drive.google.com/uc?id=1YbprW360oG3VX9bjNl1n6t8eJ6BtFX43" },
            { id: 76, name: "ãƒŠãƒ•ã‚¿ãƒ¬ãƒ³", url: "https://drive.google.com/uc?id=1KmhaqmQqwjj62u5I2Bces9WCDDZW5JnR" },
            { id: 77, name: "ã‚¨ãƒãƒ«ãƒ™ãƒ³ã‚¼ãƒ³", url: "https://drive.google.com/uc?id=1dxxG5zkCEuhCVcC5Iq9neiMOHK10HrxJ" },
            { id: 78, name: "ã‚¹ãƒãƒ¬ãƒ³", url: "https://drive.google.com/uc?id=1zkB1-129ywkhlhCfCqPCkP01jpI3Jkts" },
            { id: 79, name: "ã‚¢ãƒ³ãƒˆãƒ©ã‚»ãƒ³", url: "https://drive.google.com/uc?id=1bLmAsLWpBX1bU3HDLi2SPP3PkdRbaZL3" },
            { id: 80, name: "ãƒ‹ãƒˆãƒ­ãƒ™ãƒ³ã‚¼ãƒ³", url: "https://drive.google.com/uc?id=1299ipfDqC7IsoWjk3ZiiY6tkyJV3FjVF" },
            { id: 81, name: "ãƒ™ãƒ³ã‚¼ãƒ³ã‚¹ãƒ«ãƒ›ãƒ³é…¸", url: "https://drive.google.com/uc?id=1dymAxReQn18wHoxFjxDKev6KevOxikk2" },
            { id: 82, name: "ãƒ™ãƒ³ã‚¼ãƒ³ã‚¹ãƒ«ãƒ›ãƒ³é…¸ãƒŠãƒˆãƒªã‚¦ãƒ ", url: "https://drive.google.com/uc?id=14Io2aW8KqkzSePTbDBzda1qbSHAd8FvP" },
            { id: 83, name: "ã‚¯ãƒ­ãƒ­ãƒ™ãƒ³ã‚¼ãƒ³", url: "https://drive.google.com/uc?id=1hJTiqbYOQ6eXjxzpuJIAiDXAlLBLi9ev" },
            { id: 84, name: "ãƒ–ãƒ­ãƒ¢ãƒ™ãƒ³ã‚¼ãƒ³", url: "https://drive.google.com/uc?id=1WranYLAIfl62BrtCu53ZjDwLNjbe0YXF" },
            { id: 85, name: "ãƒ•ã‚§ãƒãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1KWv5mdo3MqNDhAocDnimV_28zHaHLO4-" },
            { id: 86, name: "o-ã‚¯ãƒ¬ã‚¾ãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1E9CXpDC8Fama-B_cEw-IyIBU99cR8HyM" },
            { id: 87, name: "m-ã‚¯ãƒ¬ã‚¾ãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1SbkDLX3iQ1v5BzRETv9-r3T74TtdwOhP" },
            { id: 88, name: "p-ã‚¯ãƒ¬ã‚¾ãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1Vo4ZLWuvX7KJJ6M4in5yK3LhdRRvvg7y" },
            { id: 89, name: "2-ãƒŠãƒ•ãƒˆãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1lOIv8i5j7hUPUanbHYppuFAgV2c3E8TW" },
            { id: 90, name: "1-ãƒŠãƒ•ãƒˆãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=16pBQ1mbe6DDQGqRYn6oB8qXfcNOQfMzH" },
            { id: 91, name: "ã‚µãƒªãƒãƒ«é…¸", url: "https://drive.google.com/uc?id=1pK4QTYn-izGgWNnKykwUdAXq4Ui-q9m7" },
            { id: 92, name: "ãƒŠãƒˆãƒªã‚¦ãƒ ãƒ•ã‚§ãƒã‚­ã‚·ãƒ‰", url: "https://drive.google.com/uc?id=1stULQIdzgq3-dtGXJTRxqx_zesQDqNlJ" },
            { id: 93, name: "2,4,6-ãƒˆãƒªãƒ–ãƒ­ãƒ¢ãƒ•ã‚§ãƒãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1pI5k4uI28IDgWXVi7B5N7dEW08IumdO5" },
            { id: 94, name: "ãƒ”ã‚¯ãƒªãƒ³é…¸(2,4,6-ãƒˆãƒªãƒ‹ãƒˆãƒ­ãƒ•ã‚§ãƒãƒ¼ãƒ«)", url: "https://drive.google.com/uc?id=1XaGFiK5PENRVqBlaC69e3G3e_OMnRAR7" },
            { id: 95, name: "å®‰æ¯é¦™é…¸", url: "https://drive.google.com/uc?id=1gMGVSqKspWzDedA0SXghz2c3inyg9djj" },
            { id: 96, name: "ãƒ•ã‚¿ãƒ«é…¸", url: "https://drive.google.com/uc?id=1N_rWbSkQyej74oE8op46m--FhDZMqQb9" },
            { id: 97, name: "ãƒ†ãƒ¬ãƒ•ã‚¿ãƒ«é…¸", url: "https://drive.google.com/uc?id=1GAvORrAFlGV5oYQmt153C6Y4-QpEexAq" },
            { id: 98, name: "ãƒ™ãƒ³ã‚ºã‚¢ãƒ«ãƒ‡ãƒ’ãƒ‰", url: "https://drive.google.com/uc?id=1Uk5Ql8uUKKbf1gJzhN9coKLJBJq3anN6" },
            { id: 99, name: "ç„¡æ°´ãƒ•ã‚¿ãƒ«é…¸", url: "https://drive.google.com/uc?id=1z7IXQ5IFp5TkVQgSIr6o5r5_S_W-Ozp9" },
            { id: 100, name: "ã‚¢ã‚»ãƒãƒ«ã‚µãƒªãƒãƒ«é…¸", url: "https://drive.google.com/uc?id=14K4Krkb2Dqf3DAm_-z4yXX4d4kWD0kG5" },
            { id: 101, name: "ã‚µãƒªãƒãƒ«é…¸ãƒ¡ãƒãƒ«", url: "https://drive.google.com/uc?id=1-int_XRJBVsU0vIgZmpnXQY4P5N_osr9" },
            { id: 102, name: "ã‚¢ãƒ‹ãƒªãƒ³", url: "https://drive.google.com/uc?id=1GePbtEc1a1QjBKVFjeh41ABzw9lMjaKM" },
            { id: 103, name: "ã‚¢ãƒ‹ãƒªãƒ³å¡©é…¸å¡©", url: "https://drive.google.com/uc?id=1_pwuRWh5fZ2MLCivvrEClhYVbj3RiI2A" },
            { id: 104, name: "ã‚¢ã‚»ãƒˆã‚¢ãƒ‹ãƒªãƒ‰", url: "https://drive.google.com/uc?id=1cbUIx6RF5glFD2vv9tQdl_-EYuHRiThL" },
            { id: 105, name: "å¡©åŒ–ãƒ™ãƒ³ã‚¼ãƒ³ã‚¸ã‚¢ã‚¾ãƒ‹ã‚¦ãƒ ", url: "https://drive.google.com/uc?id=1ndAdSMZ-2PW7cOepP4xR6od3kqa9cY0X" },
            { id: 106, name: "p-ãƒ’ãƒ‰ãƒ­ã‚­ã‚·ã‚¢ã‚¾ãƒ™ãƒ³ã‚¼ãƒ³", url: "https://drive.google.com/uc?id=1mg5ToUTzj5HwpmaOTnYuZu55CY74zSLU" },
            { id: 107, name: "1-ãƒ•ã‚§ãƒ‹ãƒ«ã‚¢ã‚¾-2-ãƒŠãƒ•ãƒˆãƒ¼ãƒ«", url: "https://drive.google.com/uc?id=1dSkKW-QhPlbZ1w9W0-O8nLo7RHcg6wDw" },
            { id: 108, name: "2,4,6-ãƒˆãƒªãƒ‹ãƒˆãƒ­ãƒˆãƒ«ã‚¨ãƒ³", url: "https://drive.google.com/uc?id=1VJ-CfAN2uishpm9wTZpCdwMsT-MST4h7" },
            { id: 109, name: "ã‚¯ãƒ¡ãƒ³", url: "https://drive.google.com/uc?id=1fHsWsXlPIvd3x3bbxm86IbWoJY-KtiZb" },
            { id: 110, name: "ã‚¯ãƒ¡ãƒ³ãƒ’ãƒ‰ãƒ­ãƒšãƒ«ã‚ªã‚­ã‚·ãƒ‰", url: "https://drive.google.com/uc?id=1zzr3qIiIpeNwJMZgrG-RuQCQYu7s8d2b" },
            { id: 111, name: "ãƒ™ãƒ³ã‚¼ãƒ³", url: "https://drive.google.com/uc?id=1JpKeyNXgIv0RXc2VntrWJCeoem-DatqZ" }
        ];

        // --- Helper: Convert Drive URL to Thumbnail URL for better stability ---
        const getDriveImageUrl = (url) => {
            if (!url) return 'https://placehold.co/400?text=No+Image';
            const match = url.match(/id=([a-zA-Z0-9_-]+)/);
            if (match && match[1]) {
                // ã‚¹ãƒãƒ›è¡¨ç¤ºå¯¾ç­–: lh3ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨
                return `https://lh3.googleusercontent.com/d/${match[1]}`;
            }
            return url;
        };

        // Convert RAW data to usable data with fixed URLs
        const COMPOUNDS = COMPOUNDS_RAW.map(c => ({
            ...c,
            url: getDriveImageUrl(c.url)
        }));

        // --- Firebase Initialization ---
        const app = window.firebaseModules.initializeApp(firebaseConfig);
        const auth = window.firebaseModules.getAuth(app);
        const db = window.firebaseModules.getFirestore(app);
        
        // --- Utils ---
        const RANKS = [
            { threshold: 0, name: "ãƒ“ãƒ¼ã‚«ãƒ¼æ´—ã„", color: "bg-gray-400" },
            { threshold: 1, name: "è¦‹ç¿’ã„å­¦ç”Ÿ", color: "bg-blue-400" },
            { threshold: 5, name: "å®Ÿé¨“åŠ©æ‰‹", color: "bg-green-400" },
            { threshold: 10, name: "ç ”ç©¶å“¡", color: "bg-teal-500" },
            { threshold: 20, name: "ä¸»ä»»ç ”ç©¶å“¡", color: "bg-indigo-500" },
            { threshold: 40, name: "åšå£«", color: "bg-purple-500" },
            { threshold: 70, name: "æ•™æˆ", color: "bg-pink-500" },
            { threshold: 100, name: "æœ‰æ©ŸåŒ–å­¦ãƒã‚¹ã‚¿ãƒ¼", color: "bg-yellow-500" }
        ];

        const getRank = (stamps) => {
            return RANKS.slice().reverse().find(r => stamps >= r.threshold) || RANKS[0];
        };

        const shuffleArray = (array) => {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        };

        // --- Modal Component ---
        const Modal = ({ isOpen, onClose, title, children, footer }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 transition-opacity">
                    <div className="bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden transform transition-all">
                        <div className="p-6">
                            <h3 className="text-xl font-bold text-gray-900 mb-4">{title}</h3>
                            <div className="max-h-[60vh] overflow-y-auto">
                                {children}
                            </div>
                        </div>
                        <div className="bg-gray-50 px-6 py-4 flex justify-end gap-2">
                            {footer ? footer : <button onClick={onClose} className="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 font-bold text-gray-700">é–‰ã˜ã‚‹</button>}
                        </div>
                    </div>
                </div>
            );
        };

        // --- Components ---

        const Loading = () => (
            <div className="flex justify-center items-center h-screen bg-green-50">
                <div className="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-green-600"></div>
            </div>
        );

        // --- Participant Counter Component ---
        const ParticipantCounter = ({ sessionId }) => {
            const [count, setCount] = useState(0);
            
            useEffect(() => {
                const q = window.firebaseModules.query(
                    window.firebaseModules.collection(db, "test_results"),
                    window.firebaseModules.where("sessionId", "==", sessionId)
                );
                const unsub = window.firebaseModules.onSnapshot(q, (snap) => {
                    setCount(snap.size);
                });
                return () => unsub();
            }, [sessionId]);
            
            return (
                <div className="flex items-center text-indigo-600 font-bold bg-indigo-50 px-3 py-1 rounded-full">
                    <span className="mr-2">ğŸ‘¥</span>
                    <span>å‚åŠ å¾…æ©Ÿä¸­: {count}å</span>
                </div>
            );
        };

        // --- Main App Component ---

        const App = () => {
            const [user, setUser] = useState(null);
            const [userData, setUserData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [view, setView] = useState("dashboard"); 
            const [activeSession, setActiveSession] = useState(null);
            const [makeupSessions, setMakeupSessions] = useState([]);
            const [activeMakeupSession, setActiveMakeupSession] = useState(null);
            const [sessionList, setSessionList] = useState([]);
            
            // Modal State
            const [modalConfig, setModalConfig] = useState({ isOpen: false, title: "", content: null, footer: null });
            
            const openModal = (title, content, footer = null) => {
                setModalConfig({ isOpen: true, title, content, footer });
            };
            const closeModal = () => {
                setModalConfig({ ...modalConfig, isOpen: false });
            };

            const refreshData = async (uid, role, classId) => {
                const userSnap = await window.firebaseModules.getDoc(window.firebaseModules.doc(db, "users", uid));
                if (userSnap.exists()) {
                    setUserData(userSnap.data());
                }

                if (role === 'student') {
                    const q = window.firebaseModules.query(
                        window.firebaseModules.collection(db, "test_sessions"),
                        // å®Œäº†æ¸ˆã¿ã‚¯ãƒ©ã‚¹ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’æ¤œç´¢ï¼ˆå˜ç´”åŒ–ã®ãŸã‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ï¼‰
                        window.firebaseModules.orderBy("startTime", "desc")
                    );
                    const snap = await window.firebaseModules.getDocs(q);
                    
                    const needed = [];
                    for (const d of snap.docs) {
                        const s = {id: d.id, ...d.data()};
                        // è‡ªåˆ†ã®ã‚¯ãƒ©ã‚¹ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã€ã‹ã¤ãã®ã‚¯ãƒ©ã‚¹ãŒå®Œäº†æ¸ˆã¿(completedClasses)ã®å ´åˆã€è¿½è©¦åˆ¤å®š
                        if (s.completedClasses && s.completedClasses.includes(classId)) {
                            const resRef = window.firebaseModules.doc(db, "test_results", `${s.id}_${uid}`);
                            const resSnap = await window.firebaseModules.getDoc(resRef);
                            
                            let needsMakeup = false;
                            let lastAttempt = 0;

                            if (!resSnap.exists()) {
                                needsMakeup = true;
                            } else {
                                const resData = resSnap.data();
                                if (resData.score < 8 && !resData.makeupPassed) {
                                    needsMakeup = true;
                                    if (resData.makeupHistory && resData.makeupHistory.length > 0) {
                                         const last = resData.makeupHistory[resData.makeupHistory.length - 1];
                                         if (last.timestamp) lastAttempt = last.timestamp.toMillis();
                                    } else if (resData.timestamp) {
                                        lastAttempt = resData.timestamp.toMillis();
                                    }
                                }
                            }
                            if (needsMakeup) needed.push({ ...s, lastAttempt });
                        }
                    }
                    setMakeupSessions(needed);
                }
            };

            // Auth Listener with Auto-Migration Logic
            useEffect(() => {
                const unsubscribe = window.firebaseModules.onAuthStateChanged(auth, async (currentUser) => {
                    setUser(currentUser);
                    if (currentUser) {
                        const userRef = window.firebaseModules.doc(db, "users", currentUser.uid);
                        const userSnap = await window.firebaseModules.getDoc(userRef);
                        
                        if (userSnap.exists()) {
                            const data = userSnap.data();
                            setUserData(data);
                            refreshData(currentUser.uid, data.role, data.classId);
                        } else {
                            // Migration Logic: Check users collection by email (created by batch)
                            if (currentUser.email) {
                                const emailRef = window.firebaseModules.doc(db, "users", currentUser.email);
                                const emailSnap = await window.firebaseModules.getDoc(emailRef);
                                
                                if (emailSnap.exists()) {
                                    // Found pre-registered data, migrate to uid document
                                    const preData = emailSnap.data();
                                    const newData = {
                                        ...preData,
                                        uid: currentUser.uid,
                                        email: currentUser.email, // Ensure email is set
                                        stamps: 0,
                                        drillStats: { attempts: 0, passes: 0 },
                                        createdAt: window.firebaseModules.serverTimestamp()
                                    };
                                    // Save to new UID doc
                                    await window.firebaseModules.setDoc(userRef, newData);
                                    // Delete old Email doc
                                    await window.firebaseModules.deleteDoc(emailRef);
                                    
                                    setUserData(newData);
                                } else {
                                    setUserData(null);
                                }
                            } else {
                                setUserData(null);
                            }
                        }
                    } else {
                        setUserData(null);
                    }
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const updateLocalUserData = (updates) => {
                setUserData(prev => {
                    if (!prev) return prev;
                    const newData = { ...prev };
                    if (updates.stamps) newData.stamps = (newData.stamps || 0) + updates.stamps;
                    if (updates.drillStats) {
                        newData.drillStats = {
                            attempts: (newData.drillStats?.attempts || 0) + (updates.drillStats.attempts || 0),
                            passes: (newData.drillStats?.passes || 0) + (updates.drillStats.passes || 0)
                        };
                    }
                    return newData;
                });
            };

            const fetchActiveSessions = async () => {
                if (!userData || userData.role !== 'student') return;
                setLoading(true);
                const q = window.firebaseModules.query(
                    window.firebaseModules.collection(db, "test_sessions"),
                    window.firebaseModules.where("status", "in", ["active", "standby"]),
                    window.firebaseModules.where("targetClasses", "array-contains", userData.classId)
                );
                const snap = await window.firebaseModules.getDocs(q);
                setSessionList(snap.docs.map(d => ({id: d.id, ...d.data()})));
                setLoading(false);
                setView("test-list");
            };

            const handleLogout = () => {
                window.firebaseModules.signOut(auth);
                setView("dashboard");
            };

            const handleRegister = async (name, classId, studentNumber, isTeacher) => {
                const role = isTeacher ? 'teacher' : 'student';
                const data = {
                    uid: user.uid,
                    email: user.email,
                    name,
                    classId,
                    studentNumber: studentNumber || "",
                    role,
                    stamps: 0,
                    drillStats: { attempts: 0, passes: 0 },
                    createdAt: window.firebaseModules.serverTimestamp()
                };
                await window.firebaseModules.setDoc(window.firebaseModules.doc(db, "users", user.uid), data);
                setUserData(data);
            };

            const startMakeup = (session) => {
                const now = Date.now();
                const oneDay = 24 * 60 * 60 * 1000;
                if (now - session.lastAttempt < oneDay) {
                    const waitHours = Math.ceil((oneDay - (now - session.lastAttempt)) / (60 * 60 * 1000));
                    return openModal("å†å—é¨“ä¸å¯", <p>å‰å›ã®å—é¨“ã‹ã‚‰24æ™‚é–“çµŒéã—ã¦ã„ã¾ã›ã‚“ã€‚<br/>ã‚ã¨ç´„{waitHours}æ™‚é–“å¾Œã«å†å—é¨“å¯èƒ½ã§ã™ã€‚</p>);
                }
                setActiveMakeupSession(session);
                setView("makeup");
            };

            const showRanking = async (sessionId, classIds) => {
                setLoading(true);
                // çµæœå–å¾—
                const q = window.firebaseModules.query(window.firebaseModules.collection(db, "test_results"), window.firebaseModules.where("sessionId", "==", sessionId));
                const snap = await window.firebaseModules.getDocs(q);
                let results = snap.docs.map(d => d.data());
                
                // ã‚¯ãƒ©ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° (æŒ‡å®šãŒã‚ã‚‹å ´åˆ)
                if (classIds && classIds.length > 0) {
                    results = results.filter(r => classIds.includes(r.classId));
                }
                
                // æœ¬è©¦é¨“ã®çµæœã®ã¿(finished)
                results = results.filter(r => r.status === 'finished');

                // ã‚½ãƒ¼ãƒˆ: ç‚¹æ•°é™é † > ã‚¿ã‚¤ãƒ æ˜‡é †
                results.sort((a, b) => b.score - a.score || a.timeTaken - b.timeTaken);
                
                const top10 = results.slice(0, 10);
                
                setLoading(false);
                openModal(
                    "ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚° TOP10",
                    <div className="space-y-2">
                        {top10.length === 0 ? <p className="text-center text-gray-500">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p> : 
                        top10.map((r, i) => (
                            <div key={i} className={`flex justify-between items-center p-3 rounded-lg ${i < 3 ? 'bg-yellow-50 border border-yellow-200' : 'bg-gray-50'}`}>
                                <div className="flex items-center gap-3">
                                    <span className={`font-bold w-6 text-center ${i===0?'text-2xl':i===1?'text-xl':i===2?'text-lg':'text-gray-500'}`}>
                                        {i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : i + 1}
                                    </span>
                                    <div>
                                        <div className="font-bold text-gray-800">{r.classId} {r.name}</div>
                                        <div className="text-xs text-gray-500">Time: {r.timeTaken ? Math.floor(r.timeTaken) : '-'}s</div>
                                    </div>
                                </div>
                                <div className="text-xl font-bold text-indigo-600">{r.score}ç‚¹</div>
                            </div>
                        ))}
                    </div>
                );
            };

            if (loading) return <Loading />;

            if (!user) return <LoginScreen openModal={openModal} />;
            if (!userData) return <RegistrationScreen onRegister={handleRegister} openModal={openModal} />;

            return (
                <div className="min-h-screen bg-green-50 p-4">
                    <Modal isOpen={modalConfig.isOpen} onClose={closeModal} title={modalConfig.title} footer={modalConfig.footer}>
                        {modalConfig.content}
                    </Modal>

                    {view === "drill" && <DrillGame user={userData} updateLocalUserData={updateLocalUserData} onBack={() => setView("dashboard")} openModal={openModal} />}
                    {view === "test-list" && (
                        <div className="min-h-screen bg-green-50 p-4">
                            <div className="max-w-md mx-auto mt-10">
                                <button onClick={() => setView("dashboard")} className="mb-4 text-gray-500 hover:underline">â† æˆ»ã‚‹</button>
                                <h2 className="text-2xl font-bold mb-4">é–‹å‚¬ä¸­ã®ãƒ†ã‚¹ãƒˆ</h2>
                                {sessionList.length === 0 ? (
                                    <div className="bg-white p-8 rounded-xl shadow text-center text-gray-500">
                                        ç¾åœ¨å‚åŠ ã§ãã‚‹ãƒ†ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        {sessionList.map(s => (
                                            <div key={s.id} className="bg-white p-6 rounded-xl shadow hover:shadow-md transition cursor-pointer"
                                                 onClick={() => { setActiveSession(s); setView("test"); }}>
                                                <h3 className="text-xl font-bold text-gray-800">{s.name}</h3>
                                                <p className="text-blue-500 font-bold mt-2">å‚åŠ ã™ã‚‹ â†’</p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                    {view === "test" && <TestRunner user={userData} session={activeSession} onBack={() => { setView("dashboard"); refreshData(user.uid, userData.role, userData.classId); }} openModal={openModal} showRanking={showRanking} />}
                    {view === "makeup" && <TestRunner user={userData} session={activeMakeupSession} isMakeup={true} onBack={() => { setView("dashboard"); setActiveMakeupSession(null); refreshData(user.uid, userData.role, userData.classId); }} openModal={openModal} />}
                    {view === "teacher" && userData.role === 'teacher' && <TeacherDashboard user={userData} onBack={() => setView("dashboard")} openModal={openModal} showRanking={showRanking} />}
                    
                    {view === "dashboard" && (
                        <div className="min-h-screen bg-green-50 p-4">
                            <header className="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm mb-6 max-w-4xl mx-auto">
                                <div>
                                    <h1 className="text-xl font-bold text-gray-800">Organic Chem Master</h1>
                                    <p className="text-sm text-gray-500">
                                        {userData.classId} {userData.studentNumber ? `No.${userData.studentNumber}` : ''} {userData.name} ({getRank(userData.stamps).name})
                                    </p>
                                </div>
                                <div className="flex gap-2 items-center">
                                     <button onClick={() => refreshData(user.uid, userData.role, userData.classId)} className="text-gray-400 hover:text-green-600 p-2" title="ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°">
                                        ğŸ”„
                                     </button>
                                     {userData.role === 'teacher' && (
                                        <button onClick={() => setView("teacher")} className="bg-purple-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-purple-700 transition">
                                            æ•™å“¡ãƒ¡ãƒ‹ãƒ¥ãƒ¼
                                        </button>
                                    )}
                                    <button onClick={handleLogout} className="text-gray-500 hover:text-red-500 px-3 py-2">
                                        ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                                    </button>
                                </div>
                            </header>

                            <main className="max-w-4xl mx-auto grid md:grid-cols-2 gap-6">
                                <div className="bg-white p-6 rounded-2xl shadow-lg">
                                    <h2 className="text-lg font-bold text-gray-700 mb-4 flex items-center">
                                        <span className="mr-2">ğŸ†</span> ã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰
                                    </h2>
                                    <div className="flex flex-wrap gap-2 mb-4 h-64 overflow-y-auto content-start p-2 bg-gray-50 rounded-lg border-inner shadow-inner">
                                        {[...Array(Math.max(20, Math.min(100, userData.stamps + (5 - userData.stamps % 5))))].map((_, i) => (
                                            <div key={i} className={`w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center border-2 text-xs md:text-sm font-bold transition-all duration-300
                                                ${i < userData.stamps ? 'border-yellow-400 bg-yellow-100 text-yellow-600 scale-100' : 'border-gray-200 text-gray-300 scale-90'}`}>
                                                {i < userData.stamps ? 'â˜…' : i + 1}
                                            </div>
                                        ))}
                                    </div>
                                    <div className="flex items-center justify-between">
                                        <div className={`px-3 py-1 rounded-full text-white text-sm font-bold ${getRank(userData.stamps).color}`}>
                                            Rank: {getRank(userData.stamps).name}
                                        </div>
                                        <div className="text-sm text-gray-500">
                                            åˆè¨ˆ: {userData.stamps}å€‹
                                        </div>
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    <button 
                                        onClick={() => setView("drill")}
                                        className="w-full bg-gradient-to-r from-green-400 to-green-600 hover:from-green-500 hover:to-green-700 text-white p-6 rounded-2xl shadow-lg transform transition hover:scale-105 flex flex-col items-center justify-center"
                                    >
                                        <span className="text-3xl mb-2">ğŸ§ª</span>
                                        <span className="text-2xl font-bold">æ¼”ç¿’ãƒ¢ãƒ¼ãƒ‰</span>
                                        <span className="text-sm opacity-90">ãƒ©ãƒ³ãƒ€ãƒ 10å•ã«æŒ‘æˆ¦ï¼ã‚¹ã‚¿ãƒ³ãƒ—GET</span>
                                    </button>

                                    <button 
                                        onClick={fetchActiveSessions}
                                        className="w-full bg-white border-2 border-indigo-100 text-indigo-600 p-6 rounded-2xl shadow-lg transform transition hover:scale-105 flex flex-col items-center justify-center hover:bg-indigo-50"
                                    >
                                        <span className="text-3xl mb-2">ğŸ“</span>
                                        <span className="text-2xl font-bold">ãƒ†ã‚¹ãƒˆä¼šå ´ã¸</span>
                                        <span className="text-sm opacity-90">é–‹å‚¬ä¸­ã®ãƒ†ã‚¹ãƒˆã‚’ç¢ºèªã™ã‚‹</span>
                                    </button>
                                    
                                    {makeupSessions.length > 0 && (
                                        <div className="bg-orange-50 border-l-4 border-orange-500 p-4 rounded-r-xl shadow-sm">
                                            <h3 className="font-bold text-orange-700 mb-2 flex items-center">
                                                <span className="mr-2">âš ï¸</span> è¿½è©¦å¯¾è±¡ã®ãƒ†ã‚¹ãƒˆãŒã‚ã‚Šã¾ã™
                                            </h3>
                                            <div className="space-y-2">
                                                {makeupSessions.map(s => {
                                                    const now = Date.now();
                                                    const oneDay = 24 * 60 * 60 * 1000;
                                                    const isLocked = now - s.lastAttempt < oneDay;
                                                    return (
                                                        <div key={s.id} className="flex justify-between items-center bg-white p-2 rounded shadow-sm">
                                                            <span className="text-sm font-bold text-gray-700">{s.name}</span>
                                                            <button 
                                                                onClick={() => startMakeup(s)}
                                                                className={`px-3 py-1 rounded text-xs font-bold ${isLocked ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-orange-500 text-white hover:bg-orange-600'}`}
                                                            >
                                                                {isLocked ? 'å¾…æ©Ÿä¸­' : 'å—é¨“ã™ã‚‹'}
                                                            </button>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                            <p className="text-xs text-orange-600 mt-2">â€»ä¸åˆæ ¼ã®å ´åˆã€å†å—é¨“ã¾ã§24æ™‚é–“å¿…è¦ã§ã™ã€‚</p>
                                        </div>
                                    )}

                                    <div className="bg-white p-4 rounded-xl shadow-sm">
                                        <h3 className="text-sm font-bold text-gray-500 mb-2">å­¦ç¿’çŠ¶æ³</h3>
                                        <div className="flex justify-between text-sm">
                                            <span>æ¼”ç¿’å›æ•°: {userData.drillStats?.attempts || 0}å›</span>
                                            <span>åˆæ ¼ç‡: {userData.drillStats?.attempts ? Math.round((userData.drillStats.passes / userData.drillStats.attempts) * 100) : 0}%</span>
                                        </div>
                                    </div>
                                </div>
                            </main>
                        </div>
                    )}
                </div>
            );
        };

        // --- Sub Components ---

        const LoginScreen = ({ openModal }) => {
            const handleGoogleLogin = async () => {
                const provider = new window.firebaseModules.GoogleAuthProvider();
                try {
                    await window.firebaseModules.signInWithPopup(auth, provider);
                } catch (error) {
                    console.error("Login failed", error);
                    openModal("ã‚¨ãƒ©ãƒ¼", <p>ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br/>{error.message}</p>);
                }
            };
            
            const handleGuestLogin = async () => {
                 try {
                    await window.firebaseModules.signInAnonymously(auth);
                } catch (error) {
                    openModal("ã‚¨ãƒ©ãƒ¼", "ã‚²ã‚¹ãƒˆãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-green-50 to-green-100 p-4">
                    <div className="bg-white p-8 rounded-3xl shadow-xl max-w-md w-full text-center">
                        <div className="text-6xl mb-4">âš—ï¸</div>
                        <h1 className="text-3xl font-bold text-gray-800 mb-2">Organic Chem Master</h1>
                        <p className="text-gray-500 mb-8">æœ‰æ©ŸåŒ–åˆç‰©ã®æ§‹é€ å¼ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†</p>
                        <div className="space-y-3">
                            <button 
                                onClick={handleGoogleLogin}
                                className="w-full bg-white border border-gray-300 text-gray-700 font-bold py-3 px-4 rounded-xl shadow-sm hover:bg-gray-50 flex items-center justify-center transition"
                            >
                                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" className="w-6 h-6 mr-2" />
                                Googleã§ãƒ­ã‚°ã‚¤ãƒ³
                            </button>
                            <div className="relative flex py-2 items-center">
                                <div className="flex-grow border-t border-gray-300"></div>
                                <span className="flex-shrink-0 mx-4 text-gray-400 text-sm">ã¾ãŸã¯</span>
                                <div className="flex-grow border-t border-gray-300"></div>
                            </div>
                            <button 
                                onClick={handleGuestLogin}
                                className="w-full bg-gray-600 text-white font-bold py-3 px-4 rounded-xl shadow-sm hover:bg-gray-700 flex items-center justify-center transition"
                            >
                                ã‚²ã‚¹ãƒˆ(åŒ¿å)ã¨ã—ã¦é–‹å§‹
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const RegistrationScreen = ({ onRegister, openModal }) => {
            const [name, setName] = useState("");
            const [classId, setClassId] = useState("3-A");
            const [studentNumber, setStudentNumber] = useState("");
            const [isTeacher, setIsTeacher] = useState(false);
            const [password, setPassword] = useState("");

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!name) return openModal("ã‚¨ãƒ©ãƒ¼", "åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
                if (isTeacher && password !== "admin123") return openModal("ã‚¨ãƒ©ãƒ¼", "æ•™å“¡ç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
                onRegister(name, classId, studentNumber, isTeacher);
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-green-50 p-4">
                    <div className="bg-white p-8 rounded-3xl shadow-xl max-w-md w-full">
                        <h2 className="text-2xl font-bold text-center mb-6">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-1">ã‚¯ãƒ©ã‚¹</label>
                                    <select 
                                        value={classId} 
                                        onChange={(e) => setClassId(e.target.value)}
                                        className="w-full p-2 border rounded-lg"
                                    >
                                        {["3-A", "3-B", "3-C", "3-D", "3-E", "æ•™å“¡"].map(c => <option key={c} value={c}>{c}</option>)}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-1">å‡ºå¸­ç•ªå·</label>
                                    <input 
                                        type="text" 
                                        value={studentNumber} 
                                        onChange={(e) => setStudentNumber(e.target.value)}
                                        className="w-full p-2 border rounded-lg"
                                        placeholder="ä¾‹: 1"
                                    />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">æ°å</label>
                                <input 
                                    type="text" 
                                    value={name} 
                                    onChange={(e) => setName(e.target.value)}
                                    className="w-full p-2 border rounded-lg"
                                    placeholder="å±±ç”° å¤ªéƒ"
                                />
                            </div>
                            <div className="pt-4 border-t">
                                <label className="flex items-center space-x-2 text-sm text-gray-600">
                                    <input type="checkbox" checked={isTeacher} onChange={(e) => setIsTeacher(e.target.checked)} />
                                    <span>æ•™å“¡ã¨ã—ã¦ç™»éŒ²ã™ã‚‹</span>
                                </label>
                            </div>
                            {isTeacher && (
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-1">ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                                    <input 
                                        type="password" 
                                        value={password} 
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full p-2 border rounded-lg"
                                        placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
                                    />
                                </div>
                            )}
                            <button type="submit" className="w-full bg-green-500 text-white font-bold py-3 rounded-xl hover:bg-green-600 transition">
                                ç™»éŒ²ã—ã¦é–‹å§‹
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const Quiz = ({ mode, questions, timeLimit, onFinish }) => {
            const [currentIdx, setCurrentIdx] = useState(0);
            const [score, setScore] = useState(0);
            const [timeLeft, setTimeLeft] = useState(timeLimit);
            const [selected, setSelected] = useState(null);
            const [showResult, setShowResult] = useState(false);
            const [answers, setAnswers] = useState([]);
            const [startTime] = useState(Date.now());

            const timerRef = useRef(null);

            useEffect(() => {
                if (showResult) return;
                timerRef.current = setInterval(() => {
                    setTimeLeft((prev) => {
                        if (prev <= 1) {
                            clearInterval(timerRef.current);
                            finishQuiz(score, answers);
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);
                return () => clearInterval(timerRef.current);
            }, [showResult, score, answers]);

            const finishQuiz = (finalScore, finalAnswers) => {
                setShowResult(true);
                onFinish({ score: finalScore, timeTaken: (Date.now() - startTime) / 1000, answers: finalAnswers });
            };

            const handleAnswer = (choice) => {
                if (selected) return;
                const isCorrect = choice.id === questions[currentIdx].correct.id;
                setSelected(isCorrect ? 'correct' : 'wrong');
                const newScore = isCorrect ? score + 1 : score;
                const newAnswers = [...answers, isCorrect];
                setScore(newScore);
                setAnswers(newAnswers);

                setTimeout(() => {
                    if (currentIdx + 1 < questions.length) {
                        setCurrentIdx(currentIdx + 1);
                        setSelected(null);
                    } else {
                        finishQuiz(newScore, newAnswers);
                    }
                }, 600);
            };

            const q = questions[currentIdx];
            if (showResult) return <div className="text-center p-10 font-bold text-2xl">é›†è¨ˆä¸­...</div>;

            return (
                <div className={`max-w-2xl mx-auto bg-white rounded-3xl shadow-xl overflow-hidden ${selected === 'correct' ? 'correct-flash' : selected === 'wrong' ? 'wrong-flash' : ''}`}>
                    <div className="bg-gray-100 p-4 flex justify-between items-center">
                        <div className="font-bold text-gray-600">Q.{currentIdx + 1} / {questions.length}</div>
                        <div className={`font-mono text-xl font-bold ${timeLeft < 10 ? 'text-red-500 animate-pulse' : 'text-gray-700'}`}>
                            â± {timeLeft}s
                        </div>
                    </div>
                    <div className="p-6 text-center">
                        {q.type === 'name-to-struct' ? (
                            <div className="mb-6">
                                <h2 className="text-sm text-gray-500 mb-2">ã“ã®æ§‹é€ å¼ã®åç§°ã¯ï¼Ÿ</h2>
                                <div className="flex justify-center">
                                    <div className="bg-white border-2 border-gray-200 rounded-xl p-4 w-64 h-48 flex items-center justify-center overflow-hidden">
                                          <img 
                                            key={q.correct.url}
                                            src={q.correct.url} 
                                            alt="structure" 
                                            className="max-w-full max-h-full object-contain" 
                                            referrerPolicy="no-referrer"
                                            onError={(e)=>{e.target.src='https://placehold.co/200?text=No+Image'}} 
                                        />
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="mb-6">
                                <h2 className="text-sm text-gray-500 mb-2">æ¬¡ã®åŒ–åˆç‰©ã®æ§‹é€ å¼ã¯ï¼Ÿ</h2>
                                <h1 className="text-3xl font-bold text-gray-800 my-8">{q.correct.name}</h1>
                            </div>
                        )}
                        <div className="grid grid-cols-2 gap-4">
                            {q.choices.map((choice, i) => (
                                <button
                                    key={choice.id}
                                    onClick={() => handleAnswer(choice)}
                                    disabled={selected !== null}
                                    className={`p-4 rounded-xl border-2 transition transform hover:scale-105 active:scale-95 flex items-center justify-center min-h-[80px]
                                        ${selected === null ? 'border-gray-200 hover:border-blue-400 hover:bg-blue-50' : ''}
                                        ${selected !== null && choice.id === q.correct.id ? 'bg-green-100 border-green-500 ring-2 ring-green-300' : ''}
                                        ${selected === 'wrong' && choice.id !== q.correct.id ? 'opacity-50' : ''}
                                    `}
                                >
                                    {q.type === 'name-to-struct' ? (
                                        <span className="font-bold text-lg">{choice.name}</span>
                                    ) : (
                                        <div className="w-full h-24 flex items-center justify-center overflow-hidden">
                                            <img 
                                                key={choice.url}
                                                src={choice.url} 
                                                alt="choice" 
                                                className="max-w-full max-h-full object-contain" 
                                                referrerPolicy="no-referrer"
                                                onError={(e)=>{e.target.src='https://placehold.co/100?text=?'}} 
                                            />
                                        </div>
                                    )}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const generateQuestions = (count) => {
            const questions = [];
            const all = shuffleArray([...COMPOUNDS]);
            for (let i = 0; i < count; i++) {
                const correct = all[i];
                const others = shuffleArray(COMPOUNDS.filter(c => c.id !== correct.id)).slice(0, 3);
                const choices = shuffleArray([correct, ...others]);
                questions.push({
                    correct,
                    choices,
                    type: Math.random() > 0.5 ? 'name-to-struct' : 'struct-to-name'
                });
            }
            return questions;
        };

        const DrillGame = ({ user, updateLocalUserData, onBack, openModal }) => {
            const [state, setState] = useState('ready');
            const [questions, setQuestions] = useState([]);
            const [result, setResult] = useState(null);

            const startDrill = () => {
                const newQuestions = generateQuestions(10);
                setQuestions(newQuestions);
                setState('playing');
            };

            const handleFinish = async (res) => {
                const passed = res.score >= 8;
                setResult({ ...res, passed });
                setState('result');
                const userRef = window.firebaseModules.doc(db, "users", user.uid);
                const updates = {
                    "drillStats.attempts": window.firebaseModules.increment(1),
                    "drillStats.passes": passed ? window.firebaseModules.increment(1) : window.firebaseModules.increment(0)
                };
                if (passed) updates.stamps = window.firebaseModules.increment(1);
                
                await window.firebaseModules.updateDoc(userRef, updates);
                updateLocalUserData({
                    stamps: passed ? 1 : 0,
                    drillStats: { attempts: 1, passes: passed ? 1 : 0 }
                });
            };

            return (
                <div className="min-h-screen bg-green-50 p-4">
                    {state === 'ready' && (
                        <div className="max-w-md mx-auto mt-20 text-center">
                            <h1 className="text-3xl font-bold mb-8">æ¼”ç¿’ãƒ¢ãƒ¼ãƒ‰</h1>
                            <div className="bg-white p-8 rounded-2xl shadow-lg mb-8">
                                <p className="text-gray-600 mb-4">10å•ä¸­8å•æ­£è§£ã§åˆæ ¼ï¼<br/>ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã‚²ãƒƒãƒˆã—ã‚ˆã†ã€‚</p>
                                <p className="text-sm text-gray-400">åˆ¶é™æ™‚é–“: 60ç§’</p>
                            </div>
                            <div className="space-y-4">
                                <button onClick={startDrill} className="w-full bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-green-600 transition text-xl">
                                    ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                                </button>
                                <button onClick={onBack} className="text-gray-500 hover:underline">æˆ»ã‚‹</button>
                            </div>
                        </div>
                    )}
                    {state === 'playing' && <Quiz mode="drill" questions={questions} timeLimit={60} onFinish={handleFinish} />}
                    {state === 'result' && (
                        <div className="max-w-md mx-auto mt-20 text-center fade-in">
                            <div className="bg-white p-8 rounded-3xl shadow-xl">
                                {result.passed ? (
                                    <div className="mb-6">
                                        <div className="text-6xl mb-4 stamp-animation">ğŸ’®</div>
                                        <h2 className="text-2xl font-bold text-green-600">åˆæ ¼ï¼</h2>
                                    </div>
                                ) : (
                                    <div className="mb-6">
                                        <div className="text-6xl mb-4">ğŸ’ª</div>
                                        <h2 className="text-2xl font-bold text-gray-700">æ®‹å¿µ...</h2>
                                    </div>
                                )}
                                <div className="text-4xl font-bold mb-2">{result.score} <span className="text-lg text-gray-400">/ 10ç‚¹</span></div>
                                <button onClick={onBack} className="w-full bg-gray-800 text-white font-bold py-3 rounded-xl hover:bg-gray-900 transition">
                                    ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const TestRunner = ({ user, session, isMakeup, onBack, openModal, showRanking }) => {
            const [status, setStatus] = useState('standby');
            const [questions, setQuestions] = useState([]);
            const [makeupResult, setMakeupResult] = useState(null);
            
            useEffect(() => {
                if (!session) return;
                
                if (isMakeup) {
                    const sessionQs = session.questionSet.map(qData => {
                        const correct = COMPOUNDS.find(c => c.id === qData.correctId);
                        const choices = qData.choiceIds.map(id => COMPOUNDS.find(c => c.id === id));
                        return { correct, choices, type: qData.type };
                    });
                    setQuestions(sessionQs);
                    setStatus('active');
                    return;
                }

                if (session.status === 'standby' || session.status === 'active') {
                    const joinSession = async () => {
                         const ref = window.firebaseModules.doc(db, "test_results", `${session.id}_${user.uid}`);
                         await window.firebaseModules.setDoc(ref, {
                            sessionId: session.id,
                            uid: user.uid,
                            name: user.name,
                            classId: user.classId,
                            studentNumber: user.studentNumber || "",
                            status: 'joined', 
                            timestamp: window.firebaseModules.serverTimestamp()
                         }, { merge: true });
                    };
                    joinSession();
                }

                const sessionRef = window.firebaseModules.doc(db, "test_sessions", session.id);
                const unsub = window.firebaseModules.onSnapshot(sessionRef, (snap) => {
                    const data = snap.data();
                    if (data.status === 'active' && status === 'standby') {
                        const sessionQs = data.questionSet.map(qData => {
                            const correct = COMPOUNDS.find(c => c.id === qData.correctId);
                            const choices = qData.choiceIds.map(id => COMPOUNDS.find(c => c.id === id));
                            return { correct, choices, type: qData.type };
                        });
                        setQuestions(sessionQs);
                        setStatus('active');
                    } else if (data.status === 'created' && status === 'standby') {
                        // Cancelled
                        onBack();
                    }
                });
                
                return () => unsub();
            }, [session, status, isMakeup]);

            const handleFinish = async (res) => {
                setStatus('finished');
                
                if (isMakeup) {
                    const passed = res.score >= 8;
                    setMakeupResult({ score: res.score, passed });
                    
                    const resRef = window.firebaseModules.doc(db, "test_results", `${session.id}_${user.uid}`);
                    const makeupRecord = { score: res.score, timestamp: window.firebaseModules.Timestamp.now() };
                    const updateData = { makeupHistory: window.firebaseModules.arrayUnion(makeupRecord) };
                    if (passed) updateData.makeupPassed = true;
                    await window.firebaseModules.setDoc(resRef, updateData, { merge: true });
                    return;
                }

                await window.firebaseModules.setDoc(window.firebaseModules.doc(db, "test_results", `${session.id}_${user.uid}`), {
                    sessionId: session.id,
                    uid: user.uid,
                    name: user.name,
                    classId: user.classId,
                    studentNumber: user.studentNumber || "",
                    score: res.score,
                    timeTaken: res.timeTaken,
                    status: 'finished', 
                    timestamp: window.firebaseModules.serverTimestamp()
                }, { merge: true });
                
                // Show Ranking
                showRanking(session.id);
            };

            return (
                <div className="min-h-screen bg-indigo-50 p-4">
                     {status === 'standby' && !isMakeup && (
                        <div className="flex flex-col items-center justify-center h-[80vh] text-center">
                            <div className="animate-pulse text-6xl mb-4">ğŸ“¡</div>
                            <h2 className="text-2xl font-bold text-indigo-900 mb-2">å…ˆç”Ÿã®åˆå›³ã‚’å¾…ã£ã¦ã„ã¾ã™...</h2>
                            <p className="text-indigo-600">{session.name}</p>
                            <p className="text-sm text-gray-500 mt-2">å‚åŠ ç™»éŒ²å®Œäº†ã€‚ãã®ã¾ã¾ãŠå¾…ã¡ãã ã•ã„ã€‚</p>
                            <button onClick={onBack} className="mt-8 text-gray-400 underline">é€€å‡º</button>
                        </div>
                    )}
                    {status === 'active' && <Quiz mode="test" questions={questions} timeLimit={60} onFinish={handleFinish} />}
                    {status === 'finished' && (
                        <div className="max-w-md mx-auto mt-20 text-center bg-white p-8 rounded-3xl shadow-xl">
                            {isMakeup ? (
                                <div>
                                    <h2 className="text-2xl font-bold mb-4">è¿½è©¦çµ‚äº†</h2>
                                    <div className={`text-5xl font-bold mb-4 ${makeupResult.passed ? 'text-green-600' : 'text-red-500'}`}>
                                        {makeupResult.score}ç‚¹
                                    </div>
                                    <div className="text-xl mb-6">
                                        {makeupResult.passed ? "ğŸ’® åˆæ ¼ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼" : "ğŸ’ª ä¸åˆæ ¼... ã¾ãŸæ˜æ—¥æŒ‘æˆ¦ã—ã¦ãã ã•ã„"}
                                    </div>
                                </div>
                            ) : (
                                <div>
                                    <h2 className="text-2xl font-bold mb-4">ãƒ†ã‚¹ãƒˆçµ‚äº†ï¼</h2>
                                    <p className="text-gray-600 mb-6">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã§è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™</p>
                                </div>
                            )}
                            <button onClick={onBack} className="mt-8 w-full bg-gray-200 text-gray-700 py-3 rounded-xl hover:bg-gray-300">æˆ»ã‚‹</button>
                        </div>
                    )}
                </div>
            );
        };

        const TeacherDashboard = ({ user, onBack, openModal, showRanking }) => {
            const [tab, setTab] = useState('tests'); // tests, data, batch, students
            const [sessions, setSessions] = useState([]);
            const [batchInput, setBatchInput] = useState("");
            const [selectedClasses, setSelectedClasses] = useState(new Set());
            const [availableClasses, setAvailableClasses] = useState([]);
            
            // CSV
            const [csvType, setCsvType] = useState('score');
            const [targetCsvClasses, setTargetCsvClasses] = useState(new Set());
            const [isAllCsvClasses, setIsAllCsvClasses] = useState(true);
            
            useEffect(() => {
                const q = window.firebaseModules.query(
                    window.firebaseModules.collection(db, "test_sessions"),
                    window.firebaseModules.orderBy("startTime", "desc")
                );
                const unsub = window.firebaseModules.onSnapshot(q, (snap) => {
                    setSessions(snap.docs.map(d => ({id: d.id, ...d.data()})));
                });
                
                const fetchClasses = async () => {
                    const usersQ = window.firebaseModules.query(window.firebaseModules.collection(db, "users"), window.firebaseModules.where("role", "==", "student"));
                    const snap = await window.firebaseModules.getDocs(usersQ);
                    const classes = new Set();
                    snap.forEach(d => {
                        const c = d.data().classId;
                        if(c) classes.add(c);
                    });
                    setAvailableClasses(Array.from(classes).sort());
                };
                fetchClasses();

                return () => unsub();
            }, []);

            // Auto-Finish Logic
            useEffect(() => {
                sessions.forEach(s => {
                    if (s.status === 'active' && s.startTime) {
                        // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ï¼ˆå¿µã®ç‚ºï¼‰
                        // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã¯ãªã„ã®ã§ã€é–‹ã„ã¦ã„ã‚‹æ•™å“¡ç”»é¢ã®ã©ã‚Œã‹1ã¤ãŒãƒˆãƒªã‚¬ãƒ¼ã™ã‚Œã°OKã¨ã„ã†ç”˜ã„é‹ç”¨
                        const elapsed = Date.now() - s.startTime.toMillis();
                        if (elapsed > 65000) { // 65ç§’çµŒéã—ã¦ã„ãŸã‚‰å¼·åˆ¶çµ‚äº†
                             closeSessionRound(s);
                        } else {
                            const timer = setTimeout(() => {
                                closeSessionRound(s);
                            }, 60000 - elapsed); // æ®‹ã‚Šæ™‚é–“
                            return () => clearTimeout(timer);
                        }
                    }
                });
            }, [sessions]);

            const createSession = async () => {
                const name = prompt("ãƒ†ã‚¹ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼š1å­¦æœŸä¸­é–“ãƒ†ã‚¹ãƒˆï¼‰");
                if (!name) return;
                const qs = generateQuestions(10).map(q => ({
                    correctId: q.correct.id,
                    choiceIds: q.choices.map(c => c.id),
                    type: q.type
                }));
                await window.firebaseModules.addDoc(window.firebaseModules.collection(db, "test_sessions"), {
                    name,
                    targetClasses: [], 
                    completedClasses: [],
                    status: 'created',
                    startTime: window.firebaseModules.serverTimestamp(),
                    questionSet: qs
                });
            };

            const toggleClass = (classId) => {
                const newSet = new Set(selectedClasses);
                if (newSet.has(classId)) newSet.delete(classId);
                else newSet.add(classId);
                setSelectedClasses(newSet);
            };

            const startStandby = async (session) => {
                if (selectedClasses.size === 0) return openModal("ã‚¨ãƒ©ãƒ¼", "å®Ÿæ–½ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„");
                await window.firebaseModules.updateDoc(window.firebaseModules.doc(db, "test_sessions", session.id), { 
                    status: 'standby',
                    targetClasses: Array.from(selectedClasses)
                });
                setSelectedClasses(new Set()); 
            };

            const startTest = async (session) => {
                if (!confirm("ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ1åˆ†å¾Œã«è‡ªå‹•çµ‚äº†ã—ã¾ã™ã€‚")) return;
                await window.firebaseModules.updateDoc(window.firebaseModules.doc(db, "test_sessions", session.id), { 
                    status: 'active',
                    startTime: window.firebaseModules.serverTimestamp() // é–‹å§‹æ™‚é–“ã‚’è¨˜éŒ²
                });
            };

            const closeSessionRound = async (session) => {
                // ç¾åœ¨ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¯ãƒ©ã‚¹ã‚’å®Œäº†ãƒªã‚¹ãƒˆã¸ç§»å‹•ã—ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’Createdã«æˆ»ã™
                const completed = [...(session.completedClasses || []), ...session.targetClasses];
                const currentTargets = session.targetClasses;
                
                await window.firebaseModules.updateDoc(window.firebaseModules.doc(db, "test_sessions", session.id), { 
                    status: 'created',
                    targetClasses: [],
                    completedClasses: completed
                });
                
                // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
                showRanking(session.id, currentTargets);
            };
            
            const cancelTest = async (session) => {
                 if (!confirm("å¾…æ©Ÿã‚’ä¸­æ­¢ã—ã¾ã™ã‹ï¼Ÿ")) return;
                 await window.firebaseModules.updateDoc(window.firebaseModules.doc(db, "test_sessions", session.id), { 
                    status: 'created',
                    targetClasses: []
                });
            };

            const handleBatchRegister = async () => {
                const lines = batchInput.trim().split('\n');
                const batch = window.firebaseModules.writeBatch(db);
                let count = 0;
                try {
                    for (const line of lines) {
                        const [email, name, classId, studentNumber] = line.split(',').map(s => s.trim());
                        if (email && name && classId) {
                            // Usersã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ç›´æ¥ä¿å­˜ã€‚ã‚­ãƒ¼ã¯Emailã€‚
                            const ref = window.firebaseModules.doc(db, "users", email);
                            batch.set(ref, { 
                                name, 
                                classId, 
                                studentNumber: studentNumber || "", 
                                email,
                                role: 'student',
                                isPreRegistered: true
                            });
                            count++;
                        }
                    }
                    await batch.commit();
                    openModal("å®Œäº†", `${count}ä»¶ã®ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬ç™»éŒ²ã—ã¾ã—ãŸã€‚`);
                    setBatchInput("");
                } catch (e) {
                    console.error(e);
                    openModal("ç™»éŒ²ã‚¨ãƒ©ãƒ¼", e.message);
                }
            };

            // ... (Other functions like downloadCSV, toggleCsvClass, clearStudents are same logic)
            const toggleCsvClass = (classId) => {
                const newSet = new Set(targetCsvClasses);
                if (newSet.has(classId)) newSet.delete(classId); else newSet.add(classId);
                setTargetCsvClasses(newSet); setIsAllCsvClasses(false);
            };
            const toggleAllCsvClasses = () => { setIsAllCsvClasses(!isAllCsvClasses); setTargetCsvClasses(new Set()); };
            const downloadCSV = async () => {
                const userSnap = await window.firebaseModules.getDocs(window.firebaseModules.collection(db, "users"));
                let users = userSnap.docs.map(d => d.data()).filter(u => u.role === 'student');
                if (!isAllCsvClasses) users = users.filter(u => targetCsvClasses.has(u.classId));
                users.sort((a, b) => {
                    if (a.classId !== b.classId) return a.classId.localeCompare(b.classId);
                    return (parseInt(a.studentNumber) || 0) - (parseInt(b.studentNumber) || 0);
                });
                let csv = "";
                if (csvType === 'drill') {
                    csv = "ã‚¯ãƒ©ã‚¹,å‡ºå¸­ç•ªå·,æ°å,ã‚¹ã‚¿ãƒ³ãƒ—æ•°,æ¼”ç¿’å®Ÿæ–½å›æ•°,æ¼”ç¿’åˆæ ¼å›æ•°,æ¼”ç¿’åˆæ ¼ç‡\n";
                    users.forEach(u => {
                        const rate = u.drillStats?.attempts ? ((u.drillStats.passes / u.drillStats.attempts) * 100).toFixed(1) : 0;
                        csv += `${u.classId},${u.studentNumber || ""},${u.name},${u.stamps},${u.drillStats?.attempts || 0},${u.drillStats?.passes || 0},${rate}%\n`;
                    });
                } else {
                    const resultSnap = await window.firebaseModules.getDocs(window.firebaseModules.collection(db, "test_results"));
                    const results = resultSnap.docs.map(d => d.data());
                    const sessionSnap = await window.firebaseModules.getDocs(window.firebaseModules.collection(db, "test_sessions"));
                    const sessionList = sessionSnap.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b) => (a.startTime?.toMillis() || 0) - (b.startTime?.toMillis() || 0));
                    csv = "ã‚¯ãƒ©ã‚¹,å‡ºå¸­ç•ªå·,æ°å";
                    sessionList.forEach(s => csv += `,${s.name}`);
                    csv += "\n";
                    users.forEach(u => {
                        let line = `${u.classId},${u.studentNumber || ""},${u.name}`;
                        sessionList.forEach(s => {
                            const res = results.find(r => r.uid === u.uid && r.sessionId === s.id);
                            if (csvType === 'score') {
                                if (res && res.status === 'finished') line += `,${res.score}`; else line += ",-";
                            } else if (csvType === 'status') {
                                if (!res) line += ",æœªå—é¨“"; else if (res.score >= 8) line += ",åˆæ ¼"; else if (res.makeupPassed) line += ",è¿½è©¦åˆæ ¼"; else line += ",ä¸åˆæ ¼";
                            }
                        });
                        csv += line + "\n";
                    });
                }
                const blob = new Blob([new Uint8Array([0xEF, 0xBB, 0xBF]), csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.setAttribute("href", url);
                link.setAttribute("download", `organic_chem_data_${csvType}.csv`);
                link.click();
            };
            const clearStudents = async () => {
                if(!confirm("æœ¬å½“ã«å…¨ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
                const snap = await window.firebaseModules.getDocs(window.firebaseModules.collection(db, "users"));
                const batch = window.firebaseModules.writeBatch(db);
                let count = 0;
                snap.forEach(d => { if (d.data().role === 'student') { batch.delete(d.ref); count++; } });
                await batch.commit();
                openModal("å‰Šé™¤å®Œäº†", `${count}ä»¶å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
            };

            return (
                <div className="min-h-screen bg-purple-50 p-4">
                    <header className="bg-white p-4 rounded-xl shadow-sm mb-6 flex justify-between items-center max-w-5xl mx-auto">
                        <h1 className="text-xl font-bold text-purple-800">æ•™å“¡ç®¡ç†ç”»é¢</h1>
                        <button onClick={onBack} className="text-gray-500">æˆ»ã‚‹</button>
                    </header>

                    <div className="max-w-5xl mx-auto">
                        <div className="flex space-x-2 mb-6">
                            {['tests', 'data', 'batch', 'students'].map(t => (
                                <button key={t} onClick={() => setTab(t)} className={`px-4 py-2 rounded-lg font-bold capitalize ${tab === t ? 'bg-purple-600 text-white' : 'bg-white text-purple-600'}`}>
                                    {t === 'tests' ? 'ãƒ†ã‚¹ãƒˆå®Ÿæ–½' : t === 'data' ? 'ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›' : t === 'batch' ? 'ç”Ÿå¾’ä¸€æ‹¬ç™»éŒ²' : 'ç”Ÿå¾’ç®¡ç†'}
                                </button>
                            ))}
                        </div>

                        {tab === 'tests' && (
                            <div>
                                <button onClick={createSession} className="mb-6 bg-purple-600 text-white px-6 py-3 rounded-xl shadow hover:bg-purple-700 font-bold">ï¼‹ æ–°è¦ãƒ†ã‚¹ãƒˆã‚’ä½œæˆ</button>
                                <div className="grid gap-4">
                                    {sessions.map(s => (
                                        <div key={s.id} className="bg-white p-6 rounded-xl shadow flex flex-col gap-4">
                                            <div className="flex justify-between items-start">
                                                <div>
                                                    <h3 className="font-bold text-lg">{s.name}</h3>
                                                    <div className="flex gap-2 mt-1">
                                                         <span className={`inline-block px-2 py-1 text-xs rounded-full ${s.status === 'active' ? 'bg-red-100 text-red-600 animate-pulse' : s.status === 'standby' ? 'bg-green-100 text-green-600' : 'bg-blue-100 text-blue-600'}`}>
                                                            {s.status === 'created' ? 'æœªå…¬é–‹' : s.status === 'standby' ? 'å¾…æ©Ÿä¸­' : 'å®Ÿæ–½ä¸­'}
                                                        </span>
                                                        {s.targetClasses && s.targetClasses.length > 0 && <span className="text-xs text-gray-500 py-1">ä»Šå›å¯¾è±¡: {s.targetClasses.join(', ')}</span>}
                                                    </div>
                                                </div>
                                                <div className="flex flex-col items-end gap-2 w-full md:w-auto">
                                                    {s.status === 'created' && (
                                                        <div className="flex flex-col gap-2 items-end w-full">
                                                            <div className="flex flex-wrap gap-2 justify-end">
                                                                {availableClasses.map(cls => {
                                                                    const isCompleted = s.completedClasses?.includes(cls);
                                                                    return (
                                                                        <label key={cls} className={`inline-flex items-center text-sm px-2 py-1 rounded border ${isCompleted ? 'bg-gray-200 text-gray-400 cursor-pointer' : 'bg-gray-50 cursor-pointer hover:bg-gray-100'}`}
                                                                            onClick={isCompleted ? (e)=>{ e.preventDefault(); showRanking(s.id, [cls]); } : null}>
                                                                            {isCompleted ? (
                                                                                <span className="mr-1">âœ… {cls} (æ¸ˆ)</span>
                                                                            ) : (
                                                                                <>
                                                                                    <input type="checkbox" className="mr-1" checked={selectedClasses.has(cls)} onChange={() => toggleClass(cls)}/>
                                                                                    {cls}
                                                                                </>
                                                                            )}
                                                                        </label>
                                                                    );
                                                                })}
                                                            </div>
                                                            <button onClick={() => startStandby(s)} className="bg-blue-500 text-white px-4 py-2 rounded shadow hover:bg-blue-600 w-full md:w-auto">å¾…æ©ŸçŠ¶æ…‹ã«ã™ã‚‹</button>
                                                        </div>
                                                    )}
                                                    {s.status === 'standby' && (
                                                        <div className="flex items-center gap-4">
                                                            <ParticipantCounter sessionId={s.id} />
                                                            <button onClick={() => startTest(s)} className="bg-red-500 text-white px-4 py-2 rounded shadow hover:bg-red-600 font-bold animate-pulse">ãƒ†ã‚¹ãƒˆé–‹å§‹ï¼</button>
                                                            <button onClick={() => cancelTest(s)} className="text-sm text-gray-400 underline">ä¸­æ­¢</button>
                                                        </div>
                                                    )}
                                                    {s.status === 'active' && (
                                                        <div className="flex items-center gap-4">
                                                            <ParticipantCounter sessionId={s.id} />
                                                            <span className="text-red-500 font-bold animate-pulse">å®Ÿæ–½ä¸­...è‡ªå‹•çµ‚äº†ã¾ã§å¾…æ©Ÿ</span>
                                                            <button onClick={() => closeSessionRound(s)} className="bg-gray-800 text-white px-4 py-2 rounded shadow hover:bg-gray-900">å¼·åˆ¶çµ‚äº†</button>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                            {/* å®Œäº†æ¸ˆã¿ã‚¯ãƒ©ã‚¹ä¸€è¦§ */}
                                            {s.completedClasses && s.completedClasses.length > 0 && (
                                                <div className="border-t pt-2">
                                                    <span className="text-xs text-gray-500">å®Ÿæ–½æ¸ˆã¿ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼‰: </span>
                                                    <div className="flex flex-wrap gap-2 mt-1">
                                                        {s.completedClasses.map(cls => (
                                                            <span key={cls} onClick={() => showRanking(s.id, [cls])} className="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded cursor-pointer hover:bg-gray-200">
                                                                {cls} ğŸ“Š
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {tab === 'data' && (
                            <div className="bg-white p-8 rounded-xl shadow">
                                <h2 className="text-xl font-bold mb-6 text-center">æˆç¸¾ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h2>
                                <div className="grid md:grid-cols-2 gap-8 mb-8">
                                    <div>
                                        <h3 className="font-bold mb-2 text-gray-700">1. å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ã‚’é¸æŠ</h3>
                                        <div className="space-y-2">
                                            {[
                                                { id: 'score', label: 'ãƒ†ã‚¹ãƒˆæˆç¸¾ (ç‚¹æ•°ä¸€è¦§)' },
                                                { id: 'status', label: 'ãƒ†ã‚¹ãƒˆåˆå¦ (åˆæ ¼ãƒ»è¿½è©¦ãƒ»ä¸åˆæ ¼)' },
                                                { id: 'drill', label: 'æ¼”ç¿’å–ã‚Šçµ„ã¿çŠ¶æ³ (ã‚¹ã‚¿ãƒ³ãƒ—ç­‰)' }
                                            ].map(type => (
                                                <label key={type.id} className={`flex items-center p-3 rounded border cursor-pointer ${csvType === type.id ? 'bg-blue-50 border-blue-500' : 'border-gray-200'}`}>
                                                    <input type="radio" name="csvType" className="mr-3" checked={csvType === type.id} onChange={() => setCsvType(type.id)} />
                                                    {type.label}
                                                </label>
                                            ))}
                                        </div>
                                    </div>
                                    <div>
                                        <h3 className="font-bold mb-2 text-gray-700">2. ã‚¯ãƒ©ã‚¹ã‚’é¸æŠ</h3>
                                        <div className="border border-gray-200 rounded p-4 h-48 overflow-y-auto">
                                            <label className="flex items-center mb-2 font-bold border-b pb-2">
                                                <input type="checkbox" className="mr-2" checked={isAllCsvClasses} onChange={toggleAllCsvClasses} />
                                                å…¨ã‚¯ãƒ©ã‚¹ä¸€æ‹¬å‡ºåŠ›
                                            </label>
                                            {!isAllCsvClasses && availableClasses.map(cls => (
                                                <label key={cls} className="flex items-center mb-1 ml-4">
                                                    <input type="checkbox" className="mr-2" checked={targetCsvClasses.has(cls)} onChange={() => toggleCsvClass(cls)} />
                                                    {cls}
                                                </label>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <div className="text-center">
                                    <button onClick={downloadCSV} className="bg-blue-600 text-white px-8 py-4 rounded-xl shadow-lg hover:bg-blue-700 font-bold w-full md:w-1/2">
                                        ğŸ“¥ CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ
                                    </button>
                                </div>
                            </div>
                        )}

                        {tab === 'batch' && (
                            <div className="bg-white p-8 rounded-xl shadow">
                                <h2 className="text-xl font-bold mb-4">ç”Ÿå¾’ã®ä¸€æ‹¬ç™»éŒ²ï¼ˆäº‹å‰åç°¿ï¼‰</h2>
                                <p className="text-sm text-gray-600 mb-4">ä»¥ä¸‹ã®å½¢å¼ã§ãƒªã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br/>ã“ã“ã§ç™»éŒ²ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ç”Ÿå¾’ãŒãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«åå‰ã¨ã‚¯ãƒ©ã‚¹ãŒè¨­å®šã•ã‚Œã¾ã™ã€‚</p>
                                <div className="bg-gray-100 p-4 rounded-lg mb-4 text-sm font-mono text-gray-600">
                                    student1@school.ed.jp, å±±ç”° å¤ªéƒ, 3-A, 1<br/>
                                    student2@school.ed.jp, éˆ´æœ¨ èŠ±å­, 3-B, 15
                                </div>
                                <textarea className="w-full h-40 p-4 border rounded-lg mb-4 font-mono text-sm" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹, æ°å, ã‚¯ãƒ©ã‚¹, å‡ºå¸­ç•ªå· (æ”¹è¡ŒåŒºåˆ‡ã‚Š)" value={batchInput} onChange={(e) => setBatchInput(e.target.value)} />
                                <button onClick={handleBatchRegister} className="bg-purple-600 text-white px-6 py-3 rounded-lg font-bold shadow hover:bg-purple-700">ä¸€æ‹¬ç™»éŒ²ã‚’å®Ÿè¡Œ</button>
                            </div>
                        )}

                        {tab === 'students' && (
                            <div className="bg-white p-8 rounded-xl shadow border-l-4 border-red-500">
                                <h2 className="text-xl font-bold mb-4 text-red-600">å±é™ºãªæ“ä½œ</h2>
                                <button onClick={clearStudents} className="bg-red-100 text-red-600 border border-red-200 px-6 py-3 rounded-lg font-bold">å…¨ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- Render ---
        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>
